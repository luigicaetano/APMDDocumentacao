{{/* Shortcode para bot칚o de copiar conte칰do de arquivo (vers칚o com visual corrigido) */}}
{{ $filepath := .Get "filepath" }}
{{ $buttonId := printf "copy-button-%s" (md5 $filepath) }}
{{ $messageId := printf "success-message-%s" (md5 $filepath) }}

{{ $resourcePath := strings.TrimPrefix "/" $filepath }}
{{ $resource := resources.Get $resourcePath }}

<div class="docsy-copy-container">
  <button id="{{ $buttonId }}" class="docsy-copy-button" 
    {{ if $resource }}data-resource="true"{{ else }}data-resource="false"{{ end }} 
    data-filepath="{{ $filepath }}">
    游늶 Copiar C칩digo
  </button>
  <div id="{{ $messageId }}" class="docsy-success-message">C칩digo copiado!</div>
</div>

{{ if $resource }}
<script>
  document.getElementById('{{ $buttonId }}').setAttribute('data-code', {{ $resource.Content | jsonify }});
</script>
{{ end }}

<script>
  (function() {
    document.getElementById('{{ $buttonId }}').addEventListener('click', async function() {
      try {
        const button = this;
        const useResource = button.getAttribute('data-resource') === 'true';
        let code;
        
        if (useResource) {
          // Usar o conte칰do carregado pelo Hugo
          code = button.getAttribute('data-code');
        } else {
          // Tentar buscar via fetch (para arquivos na pasta static)
          const filepath = button.getAttribute('data-filepath');
          const response = await fetch(filepath);
          if (!response.ok) {
            throw new Error('Arquivo n칚o encontrado: ' + filepath);
          }
          code = await response.text();
        }
        
        await navigator.clipboard.writeText(code);
        
        const message = document.getElementById('{{ $messageId }}');
        message.style.display = 'block';
        setTimeout(() => message.style.display = 'none', 2000);
      } catch (err) {
        console.error('Erro ao copiar c칩digo:', err);
        alert('Erro ao copiar o c칩digo: ' + err.message);
      }
    });
  })();
</script>

<style>
  .docsy-copy-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 10px;
    margin-bottom: 10px;
  }
  .docsy-copy-button {
    /* Cores fixas em vez de vari치veis CSS */
    background-color: #3182ce !important; 
    color: #ffffff !important;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-bottom: 5px;
    font-size: 14px;
    transition: background-color 0.2s;
    font-weight: 500;
    text-shadow: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  .docsy-copy-button:hover {
    background-color: #2b6cb0 !important;
  }
  .docsy-success-message {
    color: #2f855a;
    font-weight: bold;
    display: none;
    font-size: 14px;
  }
</style>